

DROP TABLE IF EXISTS umowy_towary;
DROP TABLE IF EXISTS towary;
DROP TABLE IF EXISTS umowy_porozumien;
DROP TABLE IF EXISTS kontrahenci;
DROP TABLE IF EXISTS uzytkownicy;

CREATE TABLE uzytkownicy (
    id INT AUTO_INCREMENT PRIMARY KEY,
    imie VARCHAR(100) NOT NULL,
    nazwisko VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    haslo VARCHAR(255) NOT NULL,
    kontrahent_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (kontrahent_id) REFERENCES kontrahenci(id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE kontrahenci (
    id INT AUTO_INCREMENT PRIMARY KEY,
    firma VARCHAR(255) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    adres VARCHAR(255) NOT NULL,
    nip VARCHAR(10) NOT NULL CHECK (nip REGEXP '^[0-9]+$'),
    czy_platnik BOOLEAN NOT NULL DEFAULT FALSE,
    wyroznik ENUM('SKLEP', 'HURTOWNIA') NOT NULL,
    uzytkownik_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (uzytkownik_id) REFERENCES uzytkownicy(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE umowy_porozumien (
    id INT AUTO_INCREMENT PRIMARY KEY,
    data_zawarcia_umowy DATE NOT NULL,
    rodzaj ENUM('Hurtowe', 'Detaliczne') NOT NULL,
    oplata BOOLEAN NOT NULL,
    rodzaj_oplaty VARCHAR(50),
    kwota_netto DECIMAL(10,2),
    wystawca_faktury INT NOT NULL,
    dostawca
    wydawca_gazetki INT NOT NULL,
    uwagi VARCHAR(255),
    rodzaj_uslugi_marketingowej ENUM('Reklama', 'Promocja', 'Kampania', 'Inne') NOT NULL,
    termin_obowiazywania_promocji_od DATE NOT NULL,
    termin_obowiazywania_promocji_do DATE NOT NULL,
    zatowarowanie_dystrybucji_od DATE NOT NULL,
    zatowarowanie_dystrybucji_do DATE NOT NULL,
    zatowarowanie_sklepu_od DATE,
    zatowarowanie_sklepu_do DATE,
    wysylka_porozumienia BOOLEAN NOT NULL,
    kontrahent_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (kontrahent_id) REFERENCES kontrahenci(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (wystawca_faktury) REFERENCES kontrahenci(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (wydawca_gazetki) REFERENCES kontrahenci(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CHECK ((oplata = TRUE AND rodzaj_oplaty IS NOT NULL AND kwota_netto IS NOT NULL) OR (oplata = FALSE AND rodzaj_oplaty IS NULL AND kwota_netto IS NULL))
);

CREATE TABLE towary (
    id INT AUTO_INCREMENT PRIMARY KEY,
    produkt VARCHAR(255) NOT NULL,
    rabat DECIMAL(10,2),
    cena_realizacji DECIMAL(10,2) NOT NULL,
    ilosc_estymowana INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE umowy_towary (
    id INT AUTO_INCREMENT PRIMARY KEY,
    umowy_id INT NOT NULL,
    towar_id INT NOT NULL,
    ilosc INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (umowy_id) REFERENCES umowy_porozumien(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (towar_id) REFERENCES towary(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE produkty (
    produkt VARCHAR(255) NOT NULL PRIMARY KEY,
    waga_g INT,
    cena_zl DECIMAL(6,2)
);

INSERT INTO produkty (produkt, waga_g, cena_zl) VALUES
('KASZANKA BEZ OSLONKI 470G', 470, 6.23),
('KIELBASA 4 SERY BEZ OSLONKI', NULL, 25.75),
('KIELBASA BEZ OSLONKI', NULL, 13.45),
('KIELBASA BIALA BEZ OSLONKI', NULL, 33.02),
('KIELBASA CIETA BEZ OSLONKI', NULL, 17.34),
('KIELBASA DLUGA BEZ OSLONKI', NULL, 16.24),
('KIELBASA DLUGA BEZ OSLONKI 500G', 500, 16.15),
('KIELBASA JALAPENO BEZ OSLONKI', NULL, 43.59),
('KIELBASA SZASZLYKOWA BEZ OSLONKI', NULL, 34.98),
('KIELBASA Z SZYNKI BEZ OSLONKI', NULL, 30.57),
('KIELBASKI DROBIOWE Z FILETEM MINI BEZ OSLONKI', NULL, 20.18),
('KIELBASKI DROBIOWE Z FILETEM MINI BEZ OSLONKI 360 G', 360, 8.75),
('KIELBASKI DROBIOWE Z FILETEM MINI BEZ OSLONKI 180 G', 180, 40.33),
('KIELBASKI MINI BEZ OSLONKI', NULL, 18.03),
('KIELBASKI MINI BEZ OSLONKI 360 G', 360, 12.99),
('KIELBASKI MINI BEZ OSLONKI 180 G', 180, 10.83),
('FLACZKI WOLOWE 800G', 800, 40.24),
('GULASZ WIEPRZOWY 800G', 800, 37.96),
('KIELBASA BIALA EXTRA', NULL, 8.35),
('KIELBASA BIALA RUSZTOWA', NULL, 6.16),
('KIELBASA CHLOPSKA', NULL, 16.73),
('KIELBASA CYGANSKA', NULL, 35.09),
('KIELBASA FRANCUSKA', NULL, 18.70),
('KIELBASA GOSPODARSKA', NULL, 45.31),
('KIELBASA GOSPODARSKA KROTKA', NULL, 49.47),
('KIELBASA GRILLOWA WEDZONA MAP', NULL, 29.27),
('KIELBASA LESNA', NULL, 13.24),
('KIELBASA MAZOWIECKA', NULL, 36.64),
('KIELBASA PODLASKA', NULL, 15.47),
('KIELBASA PODWAWELSKA', NULL, 6.01),
('KIELBASA PODWAWELSKA SPEC', NULL, 16.81),
('KIELBASA PODWAWELSKA ZLOTA', NULL, 6.81),
('KIELBASA SWOJSKA', NULL, 39.72),
('KIELBASA SZASZLYKOWA', NULL, 32.98),
('KIELBASA TORUNSKA', NULL, 13.13),
('KIELBASA TORUNSKA SPEC', NULL, 47.54),
('KIELBASA WIELKOPOLSKA', NULL, 32.32),
('KIELBASA Z KARKOWKA', NULL, 32.12),
('KIELBASA Z KIJA', NULL, 34.00),
('KIELBASA Z PIERSI KURCZAKA', NULL, 18.10),
('KIELBASA Z SEREM', NULL, 42.41),
('KIELBASA Z SZYNKI', NULL, 49.95),
('KIELBASA ZWYCZAJNA', NULL, 44.52),
('KIELBASA SLASKA', NULL, 5.74),
('KIELBASA SLASKA REGIONALNA', NULL, 43.00),
('KIELBASA SLASKA SPEC', NULL, 7.60),
('KIELBASKI BIALE KOKTAJLOWE', NULL, 38.29),
('KIELBASKI Z SEREM', NULL, 47.61),
('KIELBASKI SNIADANIOWE', NULL, 20.05),
('FILET WEDZONY Z INDYKA', NULL, 42.69),
('INDYK LUX', NULL, 20.95),
('KIELBASA KMINKOWA', NULL, 22.55),
('KIELBASA KRAKOWSKA', NULL, 31.62),
('KIELBASA KROTOSZYNSKA Z BECZKI', NULL, 46.76),
('KIELBASA PIWNA', NULL, 15.30),
('KIELBASA SZYNKOWA', NULL, 22.49),
('KIELBASA LYSECKA Z SZYNKA', NULL, 30.37),
('KIELBASA ZYWIECKA', NULL, 20.96),
('KONSERWOWA WIEPRZOWA', NULL, 37.11),
('KRAKOWSKA PARZONA', NULL, 19.47),
('KROLEWSKA', NULL, 45.86),
('KROLEWSKA KROTKA', NULL, 13.65),
('KURCZAK LUX', NULL, 21.56),
('KURCZAK W GALARECIE', NULL, 19.89),
('LUNCHEON MEAT KROLEWSKI', NULL, 7.51),
('MIELONKA EKSTRA Z LYSYCH', NULL, 28.93),
('MORTADELA FIRMOWA', NULL, 49.33),
('MORTADELA KAPITANSKA', NULL, 33.00),
('MORTADELA WEDZONA', NULL, 25.35),
('PIERS GOTOWANA', NULL, 18.84),
('PIERS Z KURCZAKA Z WARZYWAMI', NULL, 27.01),
('PIZZA', NULL, 44.62),
('POLEDWICA MIODOWA', NULL, 32.10),
('POLEDWICA MIODOWA ORYGINALNA', NULL, 28.94),
('POLEDWICZANKA Z WARZYWAMI 350G', 350, 41.14),
('POLEDWICZANKA Z WARZYWAMI JBB', NULL, 46.01),
('PRZYSMAK W KONSERWIE 325G', 325, 29.93),
('PRZYSMAK W KONSERWIE MALY', NULL, 34.91),
('SMACZEK KONSERWOWY', NULL, 6.72),
('SZYNKA GOTOWANA', NULL, 6.92),
('SZYNKA KONSERWOWA WIEPRZOWA', NULL, 34.28),
('SZYNKA NA KRAJALNICE', NULL, 27.94),
('SZYNKA Z PIERSI', NULL, 7.79),
('SZYNKA Z PIERSI MINI', NULL, 9.80),
('TYROLSKA', NULL, 5.90),
('TYROLSKA MAXI', NULL, 23.60),
('TYROLSKA MIDI', NULL, 5.99),
('WARZYWIANKA', NULL, 8.65),
('WIELKI PRZYSMAK W KONSERWIE', NULL, 39.06),
('WIEPRZOWINA Z OGORKIEM', NULL, 30.73),
('KAZIUK', NULL, 10.93),
('KIELBASA KRAKOWSKA SUCHA', NULL, 23.84),
('KRAKOWSKA PODSUSZANA', NULL, 42.17),
('ZYWIECKA PODSUSZANA', NULL, 13.64),
('GOLONKA EXTRA W KONSERWIE', NULL, 46.66),
('KIELBASA GORALSKA "MASARNIA U JOZEFA"', NULL, 13.57),
('KIELBASA PODHALANSKA', NULL, 17.39),
('KIELBASA SOLTYSOWKA "MASARNIA U JOZEFA"', NULL, 32.25),
('KIELBASA SWOJSKA Z CIELECINA', NULL, 9.56),
('KIELBASA SZLACHECKA "MASARNIA U JOZEFA"', NULL, 27.82),
('KIELBASA Z BECZKI "MASARNIA U JOZEFA"', NULL, 9.94),
('SALCESON SZEFA', NULL, 41.71),
('SCHAB BIALY', NULL, 18.40),
('SCHABOWKA W PRZYWPRZAWACH', NULL, 8.33),
('SZYNKA BIEBRZOWKA', NULL, 12.28),
('SZYNKA CHALKA', NULL, 27.11),
('SZYNKA KRUCHA', NULL, 13.07),
('WOJTOWKA', NULL, 33.73),
('WEDZOK USTRZYCKI', NULL, 48.48),
('POLEDWICA ANNY', NULL, 23.62),
('POLEDWICA SOPOCKA', NULL, 46.05),
('POLEDWICA SOPOCKA EXTRA', NULL, 9.51),
('POLEDWICA SOPOCKA REGIONALNA', NULL, 40.11),
('POLEDWICA WISNIOWA', NULL, 32.25),
('POLEDWICA LOSOSIOWA', NULL, 34.80),
('SCHAB BENEDYKTA PO ZYDOWSKU', NULL, 10.17),
('SCHAB Z BECZKI', NULL, 33.20),
('BALERON DEBOWY', NULL, 7.05),
('BALERON GOTOWANY', NULL, 22.92),
('BOCZEK Z BECZKI', NULL, 19.92),
('SZYNKA DELIKATNA Z INDYKA', NULL, 23.39),
('SZYNKA SOLTYSOWKA', NULL, 24.31),
('SZYNKA W SIATCE', NULL, 47.69),
('SZYNKA WLODARZA', NULL, 38.59),
('SZYNKA Z BECZKI', NULL, 11.93),
('SZYNKA Z KURCZAT EXTRA', NULL, 7.46),
('SZYNKA Z WEDZARNI', NULL, 46.99),
('SZYNKA ZAPIEKANA NA MASLE', NULL, 48.45),
('SZYNKA ZAWISZY', NULL, 27.14),
('SZYNKA ZLOTA', NULL, 16.57),
('CIELASZKI', NULL, 32.09),
('FILUSIE', NULL, 31.36),
('KIELBASA PAROWKOWA', NULL, 5.87),
('PAROWKI DELIKATNE', NULL, 16.23),
('PAROWKI HOT-DOG', NULL, 31.19),
('PAROWKI NOWOJORSKIE', NULL, 25.02),
('PAROWKI PARYSKIE', NULL, 7.85),
('PAROWKI STUDENCKIE', NULL, 35.94),
('PAROWKI TECZOWE MAP', NULL, 9.91),
('PAROWKI Z SZYNKI', NULL, 12.45),
('SERDELKI', NULL, 22.69),
('SERDELKI DROBIOWE', NULL, 6.55),
('POLANKI', NULL, 41.09),
('POLANKI 225G', 225, 44.69),
('POLANKI GASTRONOMICZNE', NULL, 36.75),
('KASZANKA DRWALA PMB', NULL, 18.75),
('KISZKA PASZTETOWA PMB', NULL, 12.42),
('KONSERWA WOJSKOWA PMB', NULL, 26.22),
('SALAMI ROGAL', NULL, 39.48),
('FRANKFURTERKI JALAPENO', NULL, 38.77),
('FRANKFURTERKI KLASYCZNE', NULL, 43.55),
('FRANKFURTERKI MINI', NULL, 7.94),
('FRANKFURTERKI PARZONE', NULL, 6.43),
('FRANKFURTERKI SEROWE', NULL, 12.42),
('KABANOSKI DEBOWE', NULL, 12.69),
('KABANOSY BANKIETOWE', NULL, 5.02),
('KABANOSY BANKIETOWE 240G', 240, 34.70),
('KABANOSY Z BECZKI', NULL, 18.32),
('KIELBASKI BEKONOWO-SEROWE 190G', 190, 14.46),
('KIELBASKI SLASKIE 190G', 190, 25.40),
('KISZKA PASZTETOWA', NULL, 25.66),
('LEBERKA WEDZONA', NULL, 17.65),
('PASTA Z BOCZKIEM 140G', 140, 22.16),
('PASTA Z SZYNKA I POMIDORAMI 140G', 140, 5.20),
('PASTA Z SZYNKA I SZCZYPIORKIEM 140G', 140, 11.58),
('PASZTET DELIKATESOWY EXTRA DROBIOWY Z FILETEM 250G', 250, 7.14),
('PASZTET DELIKATESOWY EXTRA Z SZYNKA 250G', 250, 38.93),
('PASZTET LUKSUSOWY', NULL, 9.95),
('PASZTET NA OKRAGLO', NULL, 40.16),
('PASZTET NA OKRAGLO 330G', 330, 41.52),
('PASZTET Z KURCZAKA', NULL, 15.28),
('PASZTET Z PIECA', NULL, 5.10),
('PASZTET ZDZICHA', NULL, 36.04),
('PASZTET ZE SZCZYPIORKIEM', NULL, 35.60),
('PASZTETOWA DROBIOWA MINI Z DODATKIEM WIEPRZOWINY 300G', 300, 49.03),
('PASZTETOWA DROBIOWA Z DODATKIEM WIEPRZOWINY', NULL, 17.46),
('PASZTETOWA FIRMOWA', NULL, 13.96),
('PASZTETOWA FIRMOWA 300G', 300, 43.49),
('PASZTETOWA FIRMOWA 700G', 700, 7.61),
('PASZTETOWA WEDZONA', NULL, 18.01),
('KASZANKA BIALA 3 ZIARNA', NULL, 13.32),
('KASZANKA GRILLOWA MAP', NULL, 33.08),
('KASZANKA GRYCZANA', NULL, 19.33),
('KASZANKA KURPIOWSKA', NULL, 6.98),
('KASZANKA NA PATELNIE', NULL, 41.12),
('KASZANKA SWOJSKA', NULL, 23.16),
('KISZKA ZIEMNIACZANA', NULL, 25.02),
('SALCESON BAWARSKI', NULL, 30.76),
('SALCESON CZARNY Z OZORKIEM', NULL, 43.68),
('SALCESON CZOSNKOWY', NULL, 34.00),
('SALCESON DELIKATESOWY', NULL, 13.82),
('SALCESON SULTANSKI', NULL, 48.51),
('SALCESON WLOSKI', NULL, 40.95),
('SALCESON WLOSKI 300G', 300, 7.08),
('SALCESON Z INDYKIEM', NULL, 46.47),
('SALCESONIK WIEPRZOWY', NULL, 27.83),
('FILET INDYKIEM FASZEROWANY', NULL, 26.35),
('GALARETA DROBIOWA EXTRA', NULL, 15.81),
('GALARETA WIEPRZOWA EXTRA', NULL, 7.14),
('GALARETA WIEPRZOWA EXTRA 370G', 370, 10.03),
('KEBAB Z PIERSI KURCZAKA', NULL, 26.83),
('KIELBASIAK PIECZONY 240G', 240, 9.08),
('PIECZEN RZYMSKA', NULL, 26.75),
('PIECZEN WIEDENSKA', NULL, 7.47),
('PIECZEN Z INDYKA Z SUSZONYMI POMIDORAMI', NULL, 20.57),
('ROLADA Z KACZKA', NULL, 16.65);

CREATE TABLE `pozostali_dostawcy` (
  `id` int(11) NOT NULL,
  `nazwa` varchar(255) NOT NULL,
  `email` varchar(150) DEFAULT NULL,
  `adres` varchar(255) NOT NULL,
  `nip` varchar(10) DEFAULT NULL CHECK (`nip` regexp '^[0-9]+$'),
  `kontrahent_id` int(11) NOT NULL,
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
);